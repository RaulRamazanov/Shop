<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/static/index.css" />
    <link rel="stylesheet" href="/static/reset.css" />
    <link rel="stylesheet" href="https://libs.cdnjs.net/font-awesome/6.5.1/css/all.css" />
    <style>
      .highlighted {
        background-color: yellow;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <a href="/"><h2 class="header__title">VR_Shop</h2></a>
        <div class="header__search-wrap">
          <input class="search header__search" type="text" placeholder="Поиск..." id="searchInput" />
          <span class="header__search-wrapper"><i class="fa-solid fa-magnifying-glass header__search-ico"></i></span>
        </div>
        <div class="header__wrapper-btns">
          <a href="{% if has_token %}/profil/{% else %}/login/{% endif %}" class="btn btn--profile">
            <i class="fa-regular fa-user header__ico"></i>
          </a>
          <button id="favoriteButton" class="btn btn--favorite">
            <i class="fa-regular fa-moon header__ico"></i>
          </button>
          <a href="{% if has_token %}/cart/{% else %}/{% endif %}" class="btn btn--profile">
            <i class="fa-solid fa-cart-shopping header__ico"></i>
          </a>
           <span class="header__price"></span> 
        </div>
      </header>
      <main class="main">
        <div class="photos">
          <div class="photo__pol-wrapper">
            <div class="photo__pol photo__pol--left">
              <img src="static/girl.jpg" alt="" />
            </div>
            <div class="photo__pol photo__pol--right">
              <img src="static/man.jpg" alt="" />
            </div>
          </div>
          <div class="photo__style-wrapper">
            <div class="photo__style photo__style--left">
              <img src="static/style(1).jpg" alt="" />
            </div>
            <div class="photo__style photo__style--center">
              <img src="static/style(2).jpg" alt="" />
            </div>
            <div class="photo__style photo__style--center">
              <img src="static/style(3).jpg" alt="" />
            </div>
            <div class="photo__style photo__style--right">
              <img src="static/style(4).jpg" alt="" />
            </div>
          </div>
        </div>
        <h2 class="chapter-title">Женщины</h2>
        <h4 class="chapter-text">Рекомендации</h4>
        <div class="cards" style="display: flex; width: 100%; flex-wrap: wrap">
          {% for item in items %}
  {% if item.pol == "W" %}
    <div class="card">
    <div class="card__img-wrapper" style="overflow: hidden">
      <img class="card__img" src="{{ item.image_url }}" alt="" />
    </div>
    <p class="card__title">{{ item.title }}</p>
    <p class="card__price">{{ item.price }}</p>
    <button class="add-to-cart-btn" data-item-id="{{ item.id }}">Добавить в корзину</button>
  </div>
  {% endif %}
{% endfor %}
        </div>
        <h2 class="chapter-title">Мужчины</h2>
        <h4 class="chapter-text">Рекомендации</h4>
        <div class="cards" style="display: flex; width: 100%; flex-wrap: wrap">
          {% for item in items %} {% if item.pol == "M" %}
          <div class="card" style="margin: 0 9px">
            <div class="card__img-wrapper">
              <img class="card__img" src="{{ item.image_url }}" alt="" />
            </div>
            <p class="card__title">{{ item.title }}</p>
            <p class="card__price">{{ item.price }}</p>
          </div>
          {% endif %} {% endfor %}
        </div>
        <h2 class="chapter-title">Партнёры</h2>
        <div class="brands">
          <div class="brand">
            <img src="static/brand1.png" alt="" />
          </div>
          <div class="brand">
            <img src="static/brand2.png" alt="" />
          </div>
          <div class="brand">
            <img src="static/brand3.png" alt="" />
          </div>
          <div class="brand">
            <img src="static/brand4.png" alt="" />
          </div>
          <div class="brand">
            <img src="static/brand5.png" alt="" />
          </div>
        </div>
      </main>
      <footer class="footer">
        <div class="footer__left">
          <div class="phone-wrapper">
            <span class="phone-wrapper__phone-number phone-number--border">+7 926 123-30-00</span>
            <span class="phone-wrapper__phone-number">+7 926 123-30-00</span>
          </div>
          <span class="footer__adress">г. Москва, 1-я Тверская-Ямская улица, дом 21</span>
        </div>
        <h2 class="footer__center">VR_Shop</h2>
        <div class="footer__right">
          <div class="footer__contact">
            <span class="footer__item"><i class="fa-brands fa-telegram footer__ico"></i></span>
            <span class="footer__item"><i class="fa-brands fa-vk footer__ico"></i></span>
            <span class="footer__item"><i class="fa-brands fa-odnoklassniki footer__ico"></i></span>
            <span class="footer__item"><i class="fa-brands fa-youtube footer__ico"></i></span>
          </div>
          <div class="footer__oplata">
            <div class="footer__svg">
              <img src="https://static.insales-cdn.com/files/1/1312/14550304/original/mir-logo_1.svg" alt="Иконка платежной системы" />
            </div>
            <div class="footer__svg">
              <img src="https://static.insales-cdn.com/files/1/1311/14550303/original/Group.svg" alt="" />
            </div>
            <div class="footer__svg">
              <img src="https://static.insales-cdn.com/files/1/1305/14550297/original/Visa.svg" alt="Иконка платежной системы" />
            </div>
          </div>
        </div>
      </footer>
    </div>
    <script>
      const searchInput = document.getElementById("searchInput");

      // Обработчик события ввода текста в поле поиска
      searchInput.addEventListener("input", function () {
        const searchTerm = searchInput.value.trim().toLowerCase();
        const paragraphs = document.querySelectorAll("p", "h4");

        paragraphs.forEach((paragraph) => {
          const text = paragraph.textContent.toLowerCase();
          const regex = new RegExp(searchTerm, "gi");
          paragraph.innerHTML = text.replace(regex, (match) => `<span class="highlighted">${match}</span>`);
        });
      });

// Получение всех кнопок "Добавить в корзину"
const addToCartButtons = document.getElementsByClassName("add-to-cart-btn");

// Добавление обработчика события при клике на каждую кнопку
Array.from(addToCartButtons).forEach(button => {
  button.addEventListener("click", async () => {
    const itemId = button.dataset.itemId;
    const itemPriceElement = button.parentElement.querySelector(".card__price");
    const itemPriceText = itemPriceElement.textContent; // Получаем текстовое содержимое элемента

    // Проверяем, содержит ли текст цифры
    if (/\d/.test(itemPriceText)) {
      // Обработка текста, чтобы получить числовое значение цены
      const itemPrice = parseFloat(itemPriceText.replace(/[^\d.,]/g, '')); 

      try {
        const response = await fetch("/add-to-cart", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            item_id: itemId,
            quantity: 1,
            price: itemPrice // Передача цены товара как части POST-запроса
          })
        });

        if (response.ok) {
          const data = await response.json();
          console.log(data.message);

          // Обновление значения суммы на странице
          const headerPrice = document.querySelector(".header__price");
          const currentPrice = parseFloat(headerPrice.innerText);
          const newPrice = (currentPrice + itemPrice).toFixed(2);
          headerPrice.innerText = newPrice;
        } else {
          throw new Error("Ошибка при добавлении товара в корзину");
        }
      } catch (error) {
        console.error(error);
      }
    } else {
      console.log("Цена не найдена или не является числом");
    }
  });
});
    </script>
  </body>
</html>
